<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garimpo Shape | Elite</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --brand: #FF8C00; --bg: #0a0a0c; --surface: #16161a; --text-dim: #94a3b8; --glass: rgba(255, 255, 255, 0.05); }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: #fff; font-family: 'Outfit', sans-serif; overflow-x: hidden; }

        header { background: rgba(10, 10, 12, 0.95); backdrop-filter: blur(15px); padding: 12px 16px; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--glass); }
        .nav-top { display: flex; align-items: center; max-width: 1200px; margin: 0 auto; gap: 15px; }
        .logo-text { font-family: 'Orbitron', sans-serif; font-size: 28px; font-weight: 900; color: var(--brand); font-style: italic; text-shadow: 0 0 10px rgba(255, 140, 0, 0.3); flex-shrink: 0; }

        .search-container { flex-grow: 1; }
        .search-container input { width: 100%; padding: 10px 16px; border-radius: 12px; border: 1px solid var(--glass); background: var(--surface); color: white; outline: none; }

        .nav-categories { display: flex; overflow-x: auto; padding: 15px 16px 5px; gap: 10px; background: var(--bg); scrollbar-width: none; }
        .nav-categories::-webkit-scrollbar { display: none; }
        .cat-item { background: var(--surface); color: var(--text-dim); padding: 8px 18px; border-radius: 12px; font-size: 13px; white-space: nowrap; cursor: pointer; border: 1px solid var(--glass); transition: 0.3s; }
        .cat-item.active { background: var(--brand); color: #000; font-weight: 700; transform: scale(1.05); }

        /* AREA DOS SUBFILTROS (O QUE ESTAVA FALTANDO) */
        .sub-filters { display: none; overflow-x: auto; padding: 5px 16px 15px; gap: 8px; scrollbar-width: none; }
        .sub-filters.visible { display: flex; }
        .sub-filters::-webkit-scrollbar { display: none; }
        .filter-chip { padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 600; border: 1px solid var(--brand); color: var(--brand); white-space: nowrap; cursor: pointer; }
        .filter-chip.active { background: var(--brand); color: #000; }

        .products-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px; max-width: 1200px; margin: 0 auto; }
        .product-card { background: var(--surface); border-radius: 20px; padding: 12px; border: 1px solid var(--glass); display: flex; flex-direction: column; }
        .product-card img { width: 100%; aspect-ratio: 1/1; object-fit: contain; background: #fff; border-radius: 15px; margin-bottom: 10px; }
        .product-title { font-size: 12px; color: #cbd5e1; height: 34px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; margin-bottom: 8px; }
        .product-price { font-size: 18px; font-weight: 800; color: #fff; margin-bottom: 10px; }
        .btn-buy { background: var(--brand); color: #000; text-decoration: none; text-align: center; padding: 10px; border-radius: 12px; font-weight: 800; font-size: 11px; text-transform: uppercase; }

        @media (min-width: 768px) { .products-grid { grid-template-columns: repeat(4, 1fr); gap: 20px; } }
    </style>
</head>
<body>
    <header>
        <div class="nav-top">
            <div class="logo-text">GS</div>
            <div class="search-container"><input type="text" id="searchInput" placeholder="Buscar no Garimpo..." onkeyup="search()"></div>
        </div>
    </header>

    <div class="nav-categories" id="catBar">
        <span class="cat-item active" onclick="filterCat('tudo', this)">Tudo</span>
        <span class="cat-item" onclick="filterCat('academia', this)">Academia</span>
        <span class="cat-item" onclick="filterCat('moda', this)">Moda Fitness</span>
        <span class="cat-item" onclick="filterCat('esportes', this)">Esportes</span>
        <span class="cat-item" onclick="filterCat('corrida', this)">Corrida</span>
        <span class="cat-item" onclick="filterCat('casa', this)">Treino em Casa</span>
        <span class="cat-item" onclick="filterCat('yoga', this)">Yoga</span>
        <span class="cat-item" onclick="filterCat('saude', this)">Saúde</span>
    </div>

    <div id="subFilterContainer" class="sub-filters"><div id="filterArea" style="display: flex; gap: 8px;"></div></div>

    <div class="products-grid" id="productGrid"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyADMJq9bH-_jO8ZFqfYt1YhuINACcaFH_o",
            authDomain: "minhas-financas-5917c.firebaseapp.com",
            projectId: "minhas-financas-5917c",
            storageBucket: "minhas-financas-5917c.firebasestorage.app",
            appId: "1:510273161807:web:5d0476841e6cc5bf51783a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const colRef = collection(db, "garimpo_produtos");

        // Definição dos subfiltros por categoria
        const subMap = {
            'academia': ['Suplementos', 'Acessórios', 'Equipamentos'],
            'moda': ['Masculino', 'Feminino', 'Calçados'],
            'esportes': ['Futebol', 'Lutas', 'Tênis', 'Outros']
        };

        onSnapshot(query(colRef, orderBy("data", "desc")), (snap) => {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            snap.forEach(d => {
                const p = d.data();
                grid.innerHTML += `
                    <div class="product-card" data-cat="${p.cat}" data-sub="${p.sub || ''}">
                        <img src="${p.img}">
                        <div class="product-title">${p.title}</div>
                        <div class="product-price">R$ ${p.price}</div>
                        <a href="${p.link}" target="_blank" class="btn-buy">Garimpar</a>
                    </div>`;
            });
        });

        window.filterCat = (cat, el) => {
            document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            
            const subContainer = document.getElementById('subFilterContainer');
            const filterArea = document.getElementById('filterArea');
            
            // Lógica para mostrar/esconder subfiltros
            if(subMap[cat]) {
                subContainer.classList.add('visible');
                filterArea.innerHTML = `<span class="filter-chip active" onclick="applySubFilter('tudo', this)">Tudo</span>` + 
                    subMap[cat].map(s => `<span class="filter-chip" onclick="applySubFilter('${s}', this)">${s}</span>`).join('');
            } else {
                subContainer.classList.remove('visible');
            }
            
            // Filtro principal
            document.querySelectorAll('.product-card').forEach(p => {
                p.style.display = (cat === 'tudo' || p.dataset.cat === cat) ? "flex" : "none";
            });
        };

        window.applySubFilter = (sub, el) => {
            document.querySelectorAll('.filter-chip').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            
            const activeCat = document.querySelector('.cat-item.active').getAttribute('onclick').match(/'([^']+)'/)[1];
            
            document.querySelectorAll('.product-card').forEach(p => {
                const matchCat = p.dataset.cat === activeCat;
                const matchSub = sub === 'tudo' || p.dataset.sub === sub;
                p.style.display = (matchCat && matchSub) ? "flex" : "none";
            });
        };

        window.search = () => {
            let q = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.product-card').forEach(p => {
                p.style.display = p.innerText.toLowerCase().includes(q) ? "flex" : "none";
            });
        };
    </script>
</body>
</html>
